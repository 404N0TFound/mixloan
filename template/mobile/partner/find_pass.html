<!DOCTYPE >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>找回账号</title>
<link rel="stylesheet" type="text/css" href="../addons/xuan_mixloan/template/style/partner/css/style.css" />
<link rel="stylesheet" type="text/css" href="../addons/xuan_mixloan/template/style/partner/css/body.css"/> 
</head>
<body>
<div class="container">
	<section id="content">
		<form action="{php echo $this->createMobileUrl('partner', array('op' => 'find_pass_submit'))}" method="post">
			<h1>找回账号</h1>
			<div>
				<input type="text" placeholder="手机号"  id="phone" name="phone" style="background-position: 10px 13px !important;" required=""/>
			</div>
			<div>
				<input type="password" placeholder="新密码" name="password" style="background-position: 10px -50px !important;" required="" />
			</div>
			<div>
				<input type="text" placeholder="验证码" id="smscode" name="smscode" style="background-position: 10px -50px !important;" required=""/>
			</div>
			<div class="">
				<span class="help-block u-errormessage" id="js-server-helpinfo">获取验证码</span>
			</div> 

			<div>
				<!-- <input type="submit" value="Log in" /> -->
				<input type="submit" value="提交" class="btn btn-primary" id="js-btn-login"/>
				<a href="{php echo $this->createMobileUrl('partner', array('op' => 'login'))}">返回登陆</a>
			</div>
		</form><!-- form -->
		
	</section><!-- content -->
    <script src="../addons/xuan_mixloan/template/style/js/jquery_3.js"></script>
    <script type="text/javascript" src="../addons/xuan_mixloan/template/style/js//layer_3.js"></script>
	<script type="text/javascript">

	$("#js-server-helpinfo").click(function(){
		getCheck();
	})
	function getCheck(){
		$("#js-server-helpinfo").unbind("click");
		var flagsms = true;
		//启动计时器，1秒执行一次
		if (flagsms) {
            var phone = $("#phone").val();
            var reg = /^(1)\d{10}$/;
            if(phone!=""){
            	if (!reg.test(phone)) {
	                layer.msg("请正确填写手机号");
	                flagsms = true;
	                $("#js-server-helpinfo").bind("click",function(){
			            getCheck();
			        });
	            }else{            	
	                $.post("{php echo $this->createMobileUrl('ajax', array('op'=>'getCode', 'type'=>'register'))}",{"phone":phone},
			        	function(data){
			        		if(data.code==0){
			        			layer.msg("已发送，请注意查收");
			        			curCount = 60;
				                InterValObj = window.setInterval(SetRemainTime, 1000);
				                flagsms = false;				                
			        		}else{
			        			layer.msg(data.msg);
			        			flagsms = true;
			        			$("#js-server-helpinfo").bind("click",function(){
						            getCheck();
						        });
			        			return false;
			        		}
			        	},'json')
	            }
            }else{
            	layer.msg("请填写手机号");
                flagsms = true;
                return false;
            }            
        }
	}
	function SetRemainTime() {
        if (curCount == 0) {
            window.clearInterval(InterValObj);//停止计时器
            flagsms = true;
            curCount = 60;
            $("#js-server-helpinfo").html("重新发送");
            code = ""; //清除验证码。如果不清除，过时间后，输入收到的验证码依然有效
            $("#js-server-helpinfo").bind("click",function(){
	            getCheck();
	        });
        }
        else {
            curCount--;
            $("#js-server-helpinfo").html(curCount+"s");
        }
    }
	</script>
</div>
</body>
</html>