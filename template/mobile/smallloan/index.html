<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>发现</title>
    <link rel="stylesheet" href="../addons/xuan_mixloan/template/style/css/main_4.css">
    <link rel="stylesheet" href="../addons/xuan_mixloan/template/style/new_smallloan/css/reset.css">
    <link rel="stylesheet" href="../addons/xuan_mixloan/template/style/new_smallloan/css/4.css">
</head>
<body>
    <style type="text/css">
        .app_header{ height: 60px; background: white}
        .app_header .div_back{position: absolute;top: 40px;left: 15px}
        .app_header .div_back img{width: 20px}
        .header_title{position: absolute;top: 40px;left: 42%;font-size: 16px}
        .title .act{color:#2e8ded;}
        .list1 li img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
        }
        .list-item{border-top: none !important}
        .foot_img img{width: 30px;height: 30px}
        .finndy{position: absolute;right: 5%;bottom: 10%}
        .finndy img{width: 50px;height: 50px}
        .title span{width: 48.5%}
        .layui-layer{
            z-index: 9999999999999 !important;
        }
    </style>
    <div class="app_header">
        <div class="header_title">发现</div>
    </div>
    {loop $list $row}
    <div class="box">
        <div class="top">
            <span>{$row['name']}</span>
            <button onclick="openNew('{php echo $this->createMobileUrl('smallloan', array('op' => 'category', 'id' => $row['id']))}')">查看更多＞＞</button>
        </div>
        <ul>
            {loop $row['list'] $value}
            <li onclick="copy({$value['id']})">
                <img src="{php echo tomedia($value['ext_info']['logo']);}">
                <p>{$value['name']}</p>
            </li>
            {/loop}
        </ul>
    </div>
    {/loop}
    <div style="height:40px;" class="agent-main"></div>
    <div class="agent-foot"   class="on">
        <a onclick="openNew('{php echo $this->createMobileUrl('loan', array('op'=>''))}')">
            <p class="foot_img"><img src="../addons/xuan_mixloan/template/style/picture/cwd_1.png" /></p>
            <p>首页</p>
        </a>
        <a  class="on">
            <p class="foot_img"><img src="../addons/xuan_mixloan/template/style/picture/evdayhot.png" /></p>
            <p>发现</p>
        </a>
        <a onclick="openNew('{php echo $this->createMobileUrl('loan', array('op'=>''))}')">
            <!-- <span class="iconfont icon-card2"></span> -->
            <p class="foot_img"><img src="../addons/xuan_mixloan/template/style/picture/i_daike_1.png" /></p>
            <p>指点客</p>
        </a>
        <a onclick="openNew('{php echo $this->createMobileUrl('user', array('op'=>''))}')">
            <p class="foot_img"><img src="../addons/xuan_mixloan/template/style/picture/personal_1.png" /></p>
            <p>个人中心</p>
        </a>
    </div>
    <style type="text/css">
        .copy_area{
            display: none;
            position: fixed;
            top: 35%;
            background: white;
            width: 90%;
            left: 5%;
            z-index: 999999999;
            border:2px solid #eae6e6;
            border-radius: 0.5rem;
        }
        .copy_span{
            padding: 1rem;
            max-height: 17rem;
            overflow: hidden;
            text-align: center;
        }
        .copy_span span{
            display: inline-block;
            width: 100%;
            font-size: 14px;
            margin-top: 2px;
        }
        #intro{
            margin-top: 5px;
            width: 100%;
            text-align: center;
            font-size: 14px;
        }
    </style>
    <div class="copy_area">
        <div class="copy_span">
            <img src="" style="width: 5rem;height: 5rem;" id="code">
            <div id="intro"></div>
        </div>
        <div style="padding:0.5rem 0;text-align: center;">
            <a style="display:inline-block;width: 45%;color:black !important" onclick="copy_short()">复制链接</a>
            <a style="display:inline-block;width: 45%;color:black !important" onclick="close_copy()">关闭</a>
        </div>
    </div>
    <textarea style="opacity: 0" id="pc_url"></textarea>
    <script src="../addons/xuan_mixloan/template/style/new_loan/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="../addons/xuan_mixloan/template/style/js/layer.js"></script>
    <script type="text/javascript" src="../addons/xuan_mixloan/template/style/mui/js/mui.min.js"></script>
    <script type="text/javascript">
    function openNew(url){
        mui.openWindow({url:url,createNew:true});
    }
    var short_url = '';
    function copy (id){
        index_lay = layer.load(1, {
            shade: [0.1,'#fff'] //0.1透明度的白色背景
        });
        $.post("{php echo $this->createMobileUrl('smallloan', array('op' => 'get_code'))}",{id:id},
            function(data){
                layer.close(index_lay);
                if (data.code == 1) {
                    $('#code').attr('src', data.data.code);
                    var str = '';
                    short_url = data.data.url;
                    $('#pc_url').val(short_url)
                    $('#intro').text(data.data.intro)
                    $('.copy_area').show();
                }else{
                    layer.msg(data.msg, function(){
                        if (data.data.url) {
                            window.location.href=data.data.url;
                        }
                    });
                    return false;
                }
            },'json')

    }
    function copy_short (){
        copy_pc();
    }
    function close_copy (){
        $('.copy_area').hide();
    }
    function copy_pc(){
        copyToClipboard(document.getElementById("pc_url"));
        document.activeElement.blur();
        if(succeed){
            layer.msg("复制成功！");
        }else{
            layer.msg("您的手机版本较低，请升级版本后重试！");
        }
    }
    function copyToClipboard(elem) {
        // create hidden text element, if it doesn't already exist
        var targetId = "_hiddenCopyText_";

        var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";

        var origSelectionStart, origSelectionEnd;
        if (isInput) {
            // can just use the original source element for the selection and copy
            target = elem;
            origSelectionStart = elem.selectionStart;
            origSelectionEnd = elem.selectionEnd;
        } else {
            // must use a temporary form element for the selection and copy
            target = document.getElementById(targetId);

            if (!target) {
                var target = document.createElement("textarea");
                target.style.position = "absolute";
                target.style.left = "-9999px";
                target.style.top = "0";
                target.id = targetId;
                document.body.appendChild(target);
            }
            target.textContent = elem.textContent;
        }
        // select the content
        var currentFocus = document.activeElement;
        target.focus();
        target.setSelectionRange(0, target.value.length);
        // copy the selection
        try {
            succeed = document.execCommand("copy");
        } catch(e) {
            succeed = false;
        }
        // restore original focus
        if (currentFocus && typeof currentFocus.focus === "function") {
            currentFocus.focus();
        }

        if (isInput) {
            elem.setSelectionRange(origSelectionStart, origSelectionEnd);
        } else {
            // clear temporary content
            target.textContent = "";
        }
        return succeed;
    }
    </script>
</body>
</html>