<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta  content="e-mail=no" name="format-detection"/>
	<title>{$config['title']}注册</title>
	<script src="../addons/xuan_mixloan/template/style/js//jquery_3.js"></script>
	<script type="text/javascript" src="../addons/xuan_mixloan/template/style/js//layer_3.js"></script>
	<link rel="stylesheet" href="../addons/xuan_mixloan/template/style/css/layer5_3.css" id="layui_layer_skinlayercss">
	<link rel="stylesheet" href="../addons/xuan_mixloan/template/style/css/swiper.min_3.css">
	<link rel="stylesheet" href="../addons/xuan_mixloan/template/style/css/main_5.css">
	<link rel="stylesheet" href="../addons/xuan_mixloan/template/style/css/base_3.css">
	<link rel="stylesheet" href="../addons/xuan_mixloan/template/style/css/new_base_5.css">
	<style type="text/css">
        html,body{background-color: #fff!important;min-height: 100%;background: white;background-repeat: no-repeat;background-size: 100%;}
		/*header*/
		div.header{width: 63%;margin: 0 auto; padding-top:55px;padding-bottom: 35px;}
		div.header ul{display: flex;overflow: hidden;}
		div.header ul li{width: 33.3%;text-align: center;float: left;}
		div.header ul li img{vertical-align: middle;}
		div.header ul li.link img{width:38%;max-height: 100%;padding-top:40%;margin-left: 10%;}
		div.header ul li.head img{width: 100%;max-width: 100%;display: block;border-radius: 100%;}
		div.header ul li.model_phone img{width: 73%;max-width: 100%;}
		/*contain*/
		div.fill_info{padding-top: 15%;}
		div.fill_info ul{border-radius: 30px!important; margin:0 auto;}
		div.fill_info ul li{position: relative; /*background-color: #fff;*/padding:25px 5px 10px 25px;border-radius: 3px;border-bottom: 1px solid #e5e5e5;overflow: hidden;}
		div.fill_info ul li span{display: inline-block;width:50px;color: #777777;line-height: 25px;}
		div.fill_info ul li label{float: left; display: inline-block;height: 25px;line-height: 25px;box-sizing: border-box;}
		div.fill_info ul li label img{display: inline-block;vertical-align: middle; width: 18px;margin:-2px 20px 0 0;}
		div.fill_info ul li input{float: left;width:80%;border:none;outline: none;height: 25px; line-height: 25px;font-size: 16px;box-sizing: border-box;-webkit-tap-highlight-color:rgba(255,255,255,0);}
		div.fill_info ul li a.validnum{position: absolute;bottom:10px; right:5%; border-radius:20px; text-align: center;color: #fff;padding:0.4rem 10px;background: #5386d2;min-width: 35px;}
		div.fill_info>p.regbg{position: fixed;width: 90%;bottom: 3%;left: 5%;}
		div.fill_info>p.regbg img{width: 100%;display: block;}
		div.fill_info ul li.re_psw span{width:70px;}
		div.submit_btn{text-align: center;}
		div.fill_info a.to_buy{display: inline-block; width:84%;margin:0px auto; margin-top:50px; height:42px;border-radius: 5px; font-size: 17px; text-align: center;line-height: 42px;color: #fff;background-color: #5386d2;letter-spacing: 5px;}
		div.fill_info>img{width: 22%;display: block;margin: 0 auto 5% auto;}
		div.regProtocol{text-indent: 6%;padding-top: 10px;}
		div.regProtocol label{display: inline;margin-right: 5px;}
		div.regProtocol label img{width: 15px;height: 15px;display: inline-block;vertical-align: middle;margin-top: -3px;}
		div.regProtocol span{color: #9a989b;font-style: 12px;display: inline;}
		div.regProtocol a{display: inline;color: #0194fc;font-style: 12px;}
	</style>
	{template 'common/wxshare'}
</head>
<script type="text/javascript" src="../addons/xuan_mixloan/template/style/mui/js/mui.min.js"></script>
<script type="text/javascript">
    function openNew(url){
        mui.openWindow({url:url});
    }
</script>
{if !is_weixin()}
<style type="text/css">
	.app_header{height: 70px;width: 100%}
</style>
<script type="text/javascript">
</script>
<div class="app_header">
</div>
{/if}
<body class="bgcolor">
	<div class="fill_info" data-id="341794">
		<img src="{php echo tomedia($config['logo']);}" />
		<ul>
			<li>
				<label><img src="../addons/xuan_mixloan/template/style/picture/phone_3.png" style="width: 16px;" /></label>
				<input type="tel" name="" id="phone" maxlength="11" placeholder="请输入您的手机号">
			</li>
			<li>
				<label><img src="../addons/xuan_mixloan/template/style/picture/cwd_1.png" /></label>
				<input type="text" name="" id="imgCode" placeholder="请输入图形验证码" style="width: 60%">
				<a style="width: 30%"><img src="" id="cache_img" style="width: 6rem" ></a>
			</li>
			<li>
				<label><img src="../addons/xuan_mixloan/template/style/picture/valid_3.png" /></label>
				<input type="number" name="" id="validcode" placeholder="请输入验证码">
				<a class="validnum">获取验证码</a>
			</li>
			<li class="psw">
				<label><img src="../addons/xuan_mixloan/template/style/picture/pswd_3.png" /></label>
				<input type="password" name="" id="psw" onpaste="return false" ondragenter="return false"  onkeyup="this.value=check(this.value)" placeholder="请设置您的登录密码">
			</li>
		</ul>
		<div class="regProtocol"><label id="protocol" data-index="1" class="choosed"><img class="selected" src="../addons/xuan_mixloan/template/style/picture/wx_noselect_3.png"><img class="noselect" style="display: none;" src="../addons/xuan_mixloan/template/style/picture/wx_select_3.png"></label><span>阅读知晓并同意</span><a href="{php echo $this->createMobileUrl('index', array('op'=>'register_contract'));}">《{$config['title']}用户注册协议》</a></div>
		<div class="submit_btn">
			<a class="to_buy">注册</a>
		</div>		
		<!-- <p class="regbg"><img src="../addons/xuan_mixloan/template/style/picture/regbg_3.png" /></p> -->
	</div>

<script type="text/javascript" src=../addons/xuan_mixloan/template/style/js/jquery_3.js></script>
<script type="text/javascript" src=../addons/xuan_mixloan/template/style/js/swiper.min_3.js></script>
<script type="text/javascript" src=../addons/xuan_mixloan/template/style/js/common_3.js></script>
<script type="text/javascript">
$('#cache_img').click(function(){
    getImgCache();
})
getImgCache();
function getImgCache(){
    $.post("{php echo $this->createMobileUrl('mix', array('op'=>'apply_cache'))}",{},
        function(data){
            if (data.code == 1) {
                $('#cache_img').attr("src", data.data.img)
            }else{
                layer.msg(data.msg);
            }
        },'json')
}
$(document).ready(function(){
	$("div.header ul li.head").find("img").load(function(){
		// 头像居中
		var ul_height=$("div.header").height();
		var header_h=$("div.header ul li.head").find("img").height();
		var margin_top=(ul_height-header_h)/2+"px";
		$("div.header ul li.head img").css("margin-top",margin_top);
		//验证码居中
		var li_h=$("div.fill_info ul li").innerHeight();
		var v_h=$("div.fill_info ul li a.validnum").height();
		var top=(li_h-v_h)/2+"px";
		$("div.fill_info ul li a.validnum").css("top",top);
	})	
})
//密码中文限制
function check(str){ 
var temp="" 
for(var i=0;i<str.length;i++) 
     if(str.charCodeAt(i)>0&&str.charCodeAt(i)<255) 
        temp+=str.charAt(i) 
return temp 
}
// 点击获取验证码
	$(".validnum").click(function(){
		getCheck();
	})
	//提交
	$(".to_buy").click(function(){
		to_buy();      
	})
	function to_buy(){
		$(".to_buy").unbind("click");
		// var name=$("#name").val();
		var phone=$("#phone").val();
		var validcode=$("#validcode").val();
		var psw=$("#psw").val();
		var psw_l=$("#psw").val().length;
		// if(name==""){
		// 	layer.msg("请输入姓名");
		// 	bind_click();
		// 	return false;
		// }
		if (phone == '请输入手机号码' || phone == '') {
            layer.msg('请输入手机号码');
            bind_click();
            return false;
        }else{
            if (!(/^1[3|4|5|7|8][0-9]\d{8}$/.test(phone))) {
                layer.msg('请输入正确的手机号');
                bind_click();
                return false;
            }
        } 
        if(validcode==""){
        	layer.msg("请输入短信验证码");
        	bind_click();
			return false;
        }
        if(psw==""){
        	layer.msg("请输入密码");
        	bind_click();
			return false;
        }
        if(psw_l<6){
        	layer.msg("密码不能少于6位");
        	bind_click();
        	return false;
        }
        if($("#protocol").attr("data-index")=="0"){
            layer.msg("请先阅读{$config['title']}用户注册协议");
            bind_click();
            return false;
        }
        $.post("{php echo $this->createMobileUrl('index', array('op'=>'register_ajax'))}",{"phone":phone,"smsCode":validcode,"pwd":psw},
        	function(data){
        		console.log(data);
        		if(data.code==1){
                    if (typeof(plus) == "undefined") {
                    	{if !is_weixin()}
                        layer.msg('注册成功，请在app内登陆');
                        {else}
                        layer.msg(data.msg,{time:2000},function(){
                            openNew(data.data.url);
                        });
                    	{/if}
                    } else {
                        layer.msg(data.msg,{time:2000},function(){
                            openNew(data.data.url);
                        });
                    }
        		}else{
        			layer.msg(data.msg);
        			bind_click();
        			return false;
        		}
        	},'json')
	}
	function bind_click(){
		$(".to_buy").bind("click",function(){
            to_buy();
        });
	}
	//验证码
	function getCheck(){
		$(".validnum").unbind("click");
		var flagsms = true;
        var cache = $('#imgCode').val();
        if (cache == '') {
            layer.tips('请输入图形验证码', '#imgCode', {
                tips: [3, '#f90'],
                time: 3000
            });
            $(".validnum").bind("click",function(){
			    getCheck();
			});
			return false;
        }
		//启动计时器，1秒执行一次
		if (flagsms) {
            var phone = $("#phone").val();
            var reg = /^(1)\d{10}$/;
            if(phone!=""){
            	if (!reg.test(phone)) {
	                layer.msg("请正确填写手机号");
	                flagsms = true;
	                $(".validnum").bind("click",function(){
			            getCheck();
			        });
	            }else{            	
	                $.post("{php echo $this->createMobileUrl('ajax', array('op'=>'getCode', 'type'=>'register'))}",{"phone":phone,"img_cache":cache},
			        	function(data){
			        		if(data.code==0){
			        			layer.msg("已发送，请注意查收");
			        			curCount = 60;
				                InterValObj = window.setInterval(SetRemainTime, 1000);
				                flagsms = false;				                
			        		}else{
			        			layer.msg(data.msg);
			        			flagsms = true;
			        			$(".validnum").bind("click",function(){
						            getCheck();
						        });
			        			return false;
			        		}
			        	},'json')
	            }
            }else{
            	layer.msg("请填写手机号");
                flagsms = true;
                return false;
            }            
        }
	}
	function SetRemainTime() {

        if (curCount == 0) {
            window.clearInterval(InterValObj);//停止计时器
            flagsms = true;
            curCount = 60;
            $(".validnum").html("重新发送");

            code = ""; //清除验证码。如果不清除，过时间后，输入收到的验证码依然有效
            $(".validnum").bind("click",function(){
	            getCheck();
	        });
        }
        else {
            curCount--;
            $(".validnum").html(curCount+"s");
        }
    }
//阅读协议选择
$("#protocol").click(function(){
	var _this=$(this);
	if(_this.attr("data-index")=="1"){
		_this.attr("data-index","0");
		_this.find("img.selected").hide();
		_this.find("img.noselect").show();
	}else{
		_this.attr("data-index","1");
		_this.find("img.selected").show();
		_this.find("img.noselect").hide();
	}
})
//避免输入法影响样式
$('input').on('focus',function(){
    window.onresize = function () {        
        var h = $(window).height();
        var u = navigator.userAgent;
        if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {
            if(h <= window.screen.availHeight/2){
                $('.regbg').hide();
            }else{
                $('.regbg').show();
            }
        }
    }
})
</script>
</body>
</html>